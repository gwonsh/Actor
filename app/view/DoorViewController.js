/*
 * File: app/view/DoorViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Actor.view.DoorViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.door',

    onRdKoreanChange: function(field, newValue, oldValue, eOpts) {
        var oldLan = localStorage.getItem('baseLanguage');
        var newLan;
        if(newValue){
            localStorage.setItem('baseLanguage', 'Korean');
            getController('Config').setLanguage('Korean');
            newLan = 'Korean';
        }
        else{
            localStorage.setItem('baseLanguage', 'English');
            getController('Config').setLanguage('English');
            newLan = 'English';
        }
        if(oldLan !== newLan) {
            window.location.href = 'index.html';
        }
    },

    onLoginButtonClick: function(button, e, eOpts) {
        var usrVal = Ext.getCmp('door').down('#fdId').getValue();
        var pasVal = Ext.getCmp('door').down('#fdPass').getValue();

        Ext.data.JsonP.request({
            url:getLoginApi(),
            params:{
                nv_id:usrVal,
                nv_pass:pasVal
            },
            success:function(response){
                if(response.result){
                    localStorage.setItem('userId', usrVal);
                    sessionId = usrVal;
                    getController('Login').onLoginSuccess(Ext.getCmp('door'));
                }
                else{
                    alert(loc.login.loginInfo);
                }
            },
            failure:function(response){
                alert('Network connection problem');
            }

        });
    },

    onLoginFrmAfterRender: function(component, eOpts) {
        //Apply menu languageset by binding
        if(localStorage.getItem('baseLanguage')){
            var baseLan = localStorage.getItem('baseLanguage');
            if(baseLan == 'Korean'){
                component.down('#rdKorean').setValue(true);
            }
            else if(baseLan === undefined || baseLan === null){
                if(localLanguage == 'Korean'){
                    component.down('#rdKorean').setValue(true);
                }
                else{
                    component.down('#rdEnglish').setValue(true);
                }
            }
            else{
                component.down('#rdEnglish').setValue(true);
            }
        }
    },

    onDoorAfterRender: function(component, eOpts) {
        //try loging in by Enter
        component.el.dom.onkeyup = function(e){
            if(e.keyCode == 13){
                component.down('#loginButton').fireEvent('click');
            }
        };
    },

    onDoorBeforeRender: function(component, eOpts) {

        // var siteName = '한영나염';
        // var siteTitle = '날염 지식정보 처리시스템';
        // var siteLogo = {
        //     "background-image":"url(resources/images/hylogo.png)",
        //     'background-repeat':'no-repeat',
        //     'opacity':0.1
        // };
        // Ext.getDoc().dom.title = siteTitle;

        var siteName = 'SMARTORI ACTOR';
        var siteTitle = 'Data management system';
        var siteLogo = {
            "background-image":"url(resources/images/actorlogo.png)",
            'background-repeat':'no-repeat',
            'opacity':0.1
        };

        this.getViewModel().setData({
            siteName:siteName,
            siteTitle:siteTitle,
            siteLogo:siteLogo
        });
    }

});
