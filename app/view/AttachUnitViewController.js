/*
 * File: app/view/AttachUnitViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Actor.view.AttachUnitViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.attachunit',

    onContainerAfterRender: function(component, eOpts) {
        component.el.on('dblclick', function(el){
            var upWin = component.up('window');
            var listCon = upWin.down('#attachCon').down('#fileList');
            var index = listCon.items.items.indexOf(component);
            //the field that was build by code "getColors"
            var fdColors = upWin.down('#getColors');
            if(fdColors && index === 0){
                var colorsCon = upWin.down('#colorsCon');
                var nextUnit = listCon.items.items[1];
                colorsCon.removeAll();
                if(nextUnit){//if next file is image, extract the colors
                    var types = ['image/png', 'image/gif', 'image/jpg', 'image/jpeg'];
                    fdColors.setValue('');
                    if(types.indexOf(nextUnit.file.type) != -1){
                        var img = new mOxie.Image();
                        img.onload = function(){
                            var image = document.createElement('img');
                            image.addEventListener('load', function(){
                                var colors = getController('Config').getColorChips(image, colorsCon);
                                fdColors.setValue(JSON.stringify(colors));
                            });
                            image.setAttribute('src', this.getAsDataURL());


                        };
                        img.load(nextUnit.file.getSource());
                    }
                }
                else{
                    fdColors.setValue('');
                }
            }

            var file = component.file;
            component.up('form').uploader.removeFile(file);
            component.destroy();
        });
    }

});
