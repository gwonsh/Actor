{
    "type": "Ext.form.field.HtmlEditor",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "extendhtmleditor",
        "designer|userClassName": "ExtendHtmlEditor",
        "enableSourceEdit": false,
        "fieldLabel": "Label",
        "height": 150
    },
    "configAlternates": {
        "designer|userAlias": "string",
        "designer|userClassName": "string",
        "fieldLabel": "string",
        "height": "auto",
        "enableSourceEdit": "boolean"
    },
    "name": "MyHtmlEditor1",
    "designerId": "45f14633-41b9-4445-87f1-8cc5ed39380c",
    "viewControllerInstanceId": "85b787f4-bf5b-4cb8-ba94-79398c0de357",
    "viewModelInstanceId": "21610a8b-4bc3-4848-9f95-bd369a4695b7",
    "cn": [
        {
            "type": "viewcontrollereventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onHtmleditorAfterRender",
                "implHandler": [
                    "var uploadWindow = component.up('window');",
                    "var showAddFiles = false;",
                    "var fileCategory;",
                    "if(getController('Main').getListTab().getActiveTab()){",
                    "    var cateOpt = getController('Main').getListTab().getActiveTab().cateOption;",
                    "    if(cateOpt.categoryForEditor !== undefined){",
                    "        showAddFiles = true;",
                    "        fileCategory = cateOpt.categoryForEditor;",
                    "    }    ",
                    "}",
                    "var tb = component.getToolbar();",
                    "var oriEditor = component;",
                    "//add htmleditor button to open big a htmleditor",
                    "tb.insert(0, {",
                    "    xtype:'button',",
                    "    iconCls:'fa fa-pencil-square',",
                    "    tooltip:loc.upload.newEditor,",
                    "    style:'font-size:20px',",
                    "    tools:[",
                    "        {",
                    "            xtype:'button',",
                    "            iconCls:'fa fa-picture-o'",
                    "        }",
                    "    ],",
                    "    listeners:{",
                    "        click:function(buttonNewEditor){",
                    "            //window including big htmleditor",
                    "            var uid = getController('Util').getUID();",
                    "            var win = Ext.create('Ext.window.Window', {",
                    "                width:900,",
                    "                padding:20,",
                    "                layout:'fit',",
                    "                categoryId:fileCategory,",
                    "                ghost:false,",
                    "                bdIdxInHtmlEditor:[],",
                    "                oriButton:buttonNewEditor,",
                    "                title:loc.main.description,",
                    "                height:windowMaxHeight,",
                    "                items:[",
                    "                    {",
                    "                        xtype:'form',",
                    "                        layout:'vbox',",
                    "                        items:[",
                    "                            {",
                    "                                xtype: 'container',",
                    "                                hidden: true,",
                    "                                itemId: 'attachCon',",
                    "                                margin: '10 0 0 0',",
                    "                                width: '100%',",
                    "                                items: [",
                    "                                    {",
                    "                                        xtype: 'label',",
                    "                                        cls: 'x-form-item-label-default',",
                    "                                        hidden: true,",
                    "                                        itemId: 'titleExistFile',",
                    "                                        bind: {",
                    "                                            text: '{attachedFile}'",
                    "                                        }",
                    "                                    },",
                    "                                    {",
                    "                                        xtype: 'container',",
                    "                                        delEntry: [",
                    "",
                    "                                        ],",
                    "                                        itemId: 'existFilesCon'",
                    "                                    },",
                    "                                    {",
                    "                                        xtype: 'container',",
                    "                                        itemId: 'attachboxHeader',",
                    "                                        items: [",
                    "                                            {",
                    "                                                xtype: 'label',",
                    "                                                cls: 'x-form-item-label-default',",
                    "                                                hidden: true,",
                    "                                                itemId: 'lbNewFileAdded',",
                    "                                                bind: {",
                    "                                                    text: '{addAttachFile}'",
                    "                                                }",
                    "                                            }",
                    "                                        ]",
                    "                                    },",
                    "                                    ///////////////////////////",
                    "                                    // added files container //",
                    "                                    ///////////////////////////",
                    "                                    {",
                    "                                        xtype: 'container',",
                    "                                        cls: 'requestform_space',",
                    "                                        itemId: 'fileList',",
                    "                                        margin: '10 0 0 0',",
                    "                                        width: '100%',",
                    "                                        layout: 'column'",
                    "                                    },",
                    "                                    /////////////////////////////////////////////////////////////////////////////////",
                    "                                    // container for inserting the button for files into content and how to remove //",
                    "                                    /////////////////////////////////////////////////////////////////////////////////",
                    "                                    {",
                    "                                        xtype:'container',",
                    "                                        cls: 'requestform_space',",
                    "                                        width:'100%',",
                    "                                        layout:'hbox',",
                    "                                        padding:'0 0 10 0',",
                    "                                        items:[",
                    "                                            {",
                    "                                                xtype:'button',",
                    "                                                text:loc.upload.insertFile,",
                    "                                                handler:function(button){",
                    "                                                    ////////////////////////////////////////////////////",
                    "                                                    // uploading files to server to insert to content //",
                    "                                                    ////////////////////////////////////////////////////",
                    "                                                    getController('Post').showUploadStatus(button.up('window'));",
                    "                                                    var win = button.up('window');",
                    "                                                    var uploader = win.down('form').uploader;",
                    "                                                    uploader.bind('UploadComplete', function onComplete(ul, files){",
                    "                                                        var caId = fileCategory;",
                    "                                                        win.down('#fileList').removeAll();",
                    "//                                                         win.down('#pickfiles').fireEvent('afterrender', win.down('#pickfiles'));",
                    "                                                        win.down('#attachCon').setHidden(true);",
                    "                                                        uploader.unbind('UploadComplete', onComplete);",
                    "                                                        if(Ext.getCmp('uploadProgress') !== undefined){ // destroy progress bar",
                    "                                                            Ext.getCmp('uploadProgress').close();",
                    "                                                        }",
                    "",
                    "                                                        //stat uploading information after files are uploaded",
                    "                                                        var url = domain + '/binder/addUpdate2';",
                    "                                                        var formData = new FormData();",
                    "                                                        var refer = uid;",
                    "                                                        formData.append('ca_id', caId);",
                    "                                                        formData.append('uploadType', \"form\");",
                    "                                                        formData.append('bd_subject', refer);",
                    "                                                        formData.append('bd_group', '1');",
                    "                                                        formData.append('bd_refer', refer);",
                    "",
                    "                                                        xhr = new XMLHttpRequest();",
                    "                                                        xhr.open('POST', url, true);",
                    "                                                        xhr.onload = function() {",
                    "                                                            if (xhr.status === 200) {",
                    "                                                                Ext.toast(loc.upload.saved);",
                    "                                                                //get list from just added one by bd_refer",
                    "                                                                Ext.data.JsonP.request({",
                    "                                                                    url:getDataListByIdApi('&se_refer=' + refer, true),",
                    "                                                                    success:function(response){",
                    "                                                                        //dispatch event to big htmleditor window",
                    "                                                                        var files = response.binderList[0].bd_file;",
                    "                                                                        var i, val;",
                    "                                                                        var bigEditor = button.up('window').down('htmleditor');",
                    "",
                    "                                                                        //save bd_idx of uploaded files to delete when cancel uploading.",
                    "                                                                        win.bdIdxInHtmlEditor.push(response.binderList[0].bd_idx);",
                    "                                                                        var mainView = getController('Main').getMainView();",
                    "                                                                        uploadWindow.bdIdxInHtmlEditor = [];",
                    "                                                                        uploadWindow.bdIdxInHtmlEditor.push(response.binderList[0].bd_idx);",
                    "",
                    "                                                                        //separate the display methods",
                    "                                                                        for(i=0; i<files.length; i++){",
                    "                                                                            if(getController('Config').isImage(files[i])){//for images",
                    "                                                                                var fw = 768;",
                    "                                                                                if(files[i].file_width < 768){",
                    "                                                                                    fw = files[i].file_width;",
                    "                                                                                }",
                    "                                                                                val = bigEditor.getValue();",
                    "                                                                                var imgTag = '<img class=\"referImage\" bdIdx=\"'+response.binderList[0].bd_idx+'\"';",
                    "                                                                                imgTag += ' style=\"width:'+fw+'px;max-width:100%\" src=\"'+files[i].thumb_path+'/s\"';",
                    "                                                                                imgTag += ' downSrc=\"'+files[i].file_path+'\"';",
                    "                                                                                imgTag += ' viewSrc=\"'+files[i].file_path+'\"';",
                    "                                                                                imgTag += ' thumbSrc=\"'+files[i].thumb_path+'\"';",
                    "                                                                                imgTag += ' filename=\"'+files[i].file_name+'\"';",
                    "                                                                                imgTag += ' filesize=\"'+files[i].file_size+'\"';",
                    "                                                                                imgTag += ' pixels=\"'+files[i].file_width*files[i].file_height+'\"';",
                    "                                                                                imgTag += ' resol=\"'+files[i].file_width+'x'+files[i].file_height+'\"';",
                    "                                                                                imgTag += ' onclick=\"getController(\\'Viewer\\').viewAttachedFile([this])\">&nbsp;';",
                    "                                                                                bigEditor.setValue(val + imgTag);",
                    "                                                                            }",
                    "                                                                            else{//for normal files",
                    "                                                                                val = bigEditor.getValue();",
                    "                                                                                var linkTag = '<i style=\"margin-right:6px\" class=\"fa fa-paperclip\" aria-hidden=\"true\"></i>';",
                    "                                                                                linkTag += '<a style=\"margin-right:10px\" href=\"'+files[i].file_path+'\">';",
                    "                                                                                linkTag += files[i].file_name+'</a>';",
                    "                                                                                bigEditor.setValue(val + linkTag);",
                    "                                                                            }",
                    "                                                                        }",
                    "//                                                                         obj.oPath = entry.getAttribute('viewSrc');",
                    "//                                                                         obj.dPath = entry.getAttribute('downSrc');",
                    "//                                                                         obj.tPath = entry.getAttribute('thumbSrc');",
                    "//                                                                         obj.filename = entry.getAttribute('filename');",
                    "//                                                                         obj.filesize = entry.getAttribute('filesize');",
                    "//                                                                         obj.pixels = entry.getAttribute('pixels');",
                    "//                                                                         obj.resol = entry.getAttribute('resolution');",
                    "",
                    "                                                                        oriEditor.setValue(button.up('window').down('htmleditor').getValue());",
                    "                                                                        win.oriButton.fireEvent('click', win.oriButton);//buton for open new html editor",
                    "                                                                        win.close();",
                    "                                                                    }",
                    "                                                                });",
                    "",
                    "                                                            } else {",
                    "                                                                alert('An error occurred!');",
                    "                                                            }",
                    "                                                        };",
                    "                                                        xhr.send(formData);",
                    "                                                    });",
                    "                                                }",
                    "                                            },",
                    "                                            {",
                    "                                                xtype: 'label',",
                    "                                                hidden: true,",
                    "                                                margin:'6 0 0 10 ',",
                    "                                                itemId: 'howToRemove',",
                    "                                                style: 'color:#5FA2DD !important'",
                    "                                            }",
                    "                                        ]",
                    "",
                    "                                    }",
                    "                                ]",
                    "                            },",
                    "                            ////////////////////",
                    "                            // big htmleditor //",
                    "                            ////////////////////",
                    "                            {",
                    "                                xtype:'htmleditor',",
                    "                                flex:1,",
                    "                                width:'100%',",
                    "                                enableFont:false,",
                    "                                enableSourceEdit: false,",
                    "                                listeners:{",
                    "                                    afterrender:function(editor){",
                    "                                        editor.setValue( oriEditor.getValue());",
                    "                                    }",
                    "                                }",
                    "                            }",
                    "                        ]",
                    "                    }",
                    "                ],",
                    "                dockedItems: [",
                    "                    {",
                    "                        xtype: 'container',",
                    "                        flex: 1,",
                    "                        dock: 'bottom',",
                    "                        itemId: 'buttonCon',",
                    "                        margin: '20 0 0 0',",
                    "                        padding:'15 0 30 0',",
                    "                        style:'border-top:3px solid #bebebe',",
                    "                        layout: {",
                    "                            type: 'hbox',",
                    "                            align: 'middle',",
                    "                            pack: 'center'",
                    "                        },",
                    "                        items: [",
                    "                            {",
                    "                                xtype: 'button',",
                    "                                itemId: 'btnSubmit',",
                    "                                glyph:'xf093@FontAwesome',",
                    "                                text: loc.config.apply,",
                    "                                handler:function(button){",
                    "                                    oriEditor.setValue(button.up('window').down('htmleditor').getValue());",
                    "                                    button.up('window').close();",
                    "                                }",
                    "                            },",
                    "                            {",
                    "                                xtype: 'button',",
                    "                                itemId: 'pickfiles',",
                    "                                margin: '0 0 0 10',",
                    "                                hidden:!showAddFiles,",
                    "                                listeners:{",
                    "                                    afterrender:function(button){",
                    "                                        button.setText(loc.upload.addReferFile);",
                    "                                        getController('Post').onPickfilesAfterRender(button);",
                    "                                    }",
                    "                                }",
                    "                            },",
                    "                            {",
                    "                                xtype: 'button',",
                    "                                itemId: 'btnCancel',",
                    "                                margin: '0 0 0 10',",
                    "                                glyph:'xf00d@FontAwesome',",
                    "                                bind: {",
                    "                                    text: '{cancel}'",
                    "                                },",
                    "                                listeners: {",
                    "                                    click: function(button){",
                    "                                        var bdIdxs = button.up('window').bdIdxInHtmlEditor;",
                    "                                        if(bdIdxs.length > 0){",
                    "                                            var idxs = bdIdxs.join();",
                    "                                            Ext.data.JsonP.request({",
                    "                                                url:domain + '/json/delete?bd_idx=' + idxs",
                    "                                            });",
                    "                                        }",
                    "                                        button.up('window').close();",
                    "                                    }",
                    "                                }",
                    "                            }",
                    "                        ]",
                    "                    }",
                    "                ]",
                    "            }).show();",
                    "        }",
                    "    }",
                    "});"
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "configAlternates": {
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onHtmleditorAfterRender",
            "designerId": "849f95d6-3a20-4943-ad3d-dcbc3e56e6cf"
        }
    ]
}